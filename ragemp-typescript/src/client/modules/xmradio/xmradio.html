<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XM Radio</title>
    <style>
        /* Seu CSS "Apple Face" da versão anterior permanece aqui. Cole-o novamente. */
        /* Vou omitir o CSS aqui para economizar espaço, mas ele deve ser o mesmo */
        /* da versão que você gostou, com o container principal, lista, inputs, etc. */
        /* Apenas certifique-se que o .radio-container tem display: flex ou block por padrão */
        :root {
            --bg-color: #1c1c1e;
            --container-bg-color: #2c2c2e;
            --text-color: #f5f5f7;
            --text-secondary-color: #8e8e93;
            --accent-color: #0a84ff;
            --hover-bg-color: #3a3a3c;
            --border-color: #444446;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --border-radius: 12px;
        }
        body {
            font-family: var(--font-family);
            /*background-color: rgba(0, 0, 0, 0.6);  Fundo escuro com leve transparência */
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .radio-container {
            /* Estilo do container principal aqui... */
            /* Importante: display: flex; por padrão para ser visível */
            display: flex; /* Ou block, dependendo do seu layout interno */
            flex-direction: column;
            background-color: var(--container-bg-color);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 380px;
            position: relative;
        }
        .close-btn {
            position: absolute; top: 15px; right: 15px; background: #4d4d4d; color: var(--text-secondary-color);
            border: none; border-radius: 50%; width: 28px; height: 28px; font-size: 14px;
            line-height: 28px; text-align: center; cursor: pointer; transition: background-color 0.2s, color 0.2s;
        }
        .close-btn:hover { background-color: #ff453a; color: white; }
        h2 { text-align: center; margin-top: 0; margin-bottom: 20px; font-size: 22px; font-weight: 600; color: var(--text-color); }
        .radio-list-section h3 { font-size: 14px; font-weight: 500; color: var(--text-secondary-color); margin-top: 0; margin-bottom: 8px; padding-left: 5px;}
        .radio-list { list-style: none; padding: 0; margin: 0 0 20px 0; max-height: 160px; overflow-y: auto; background-color: rgba(0,0,0,0.1); border-radius: 8px; border: 1px solid var(--border-color); }
        .radio-list li { padding: 12px 15px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background-color 0.2s, color 0.2s; font-size: 15px; }
        .radio-list li:hover { background-color: var(--hover-bg-color); color: var(--text-color); }
        .radio-list li:last-child { border-bottom: none; }
        .radio-list::-webkit-scrollbar { width: 8px; }
        .radio-list::-webkit-scrollbar-track { background: var(--container-bg-color); border-radius: 8px; }
        .radio-list::-webkit-scrollbar-thumb { background-color: var(--text-secondary-color); border-radius: 8px; border: 2px solid var(--container-bg-color); }
        .radio-list::-webkit-scrollbar-thumb:hover { background-color: #787880; }
        .custom-url-section { margin-bottom: 20px; }
        .custom-url-section label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--text-secondary-color); padding-left: 5px; }
        .input-group { display: flex; align-items: center; }
        .custom-url-section input[type="text"] { flex-grow: 1; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 8px; background-color: #3a3a3c; color: var(--text-color); font-size: 14px; margin-right: 8px; }
        .custom-url-section input[type="text"]::placeholder { color: var(--text-secondary-color); opacity: 0.7; }
        .custom-url-section input[type="text"]:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(10, 132, 255, 0.3); }
        .custom-url-section button, .controls #playPauseBtn { /* playPauseBtn agora tem o mesmo estilo */ padding: 10px 15px; background-color: var(--accent-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.2s; }
        .custom-url-section button:hover, .controls #playPauseBtn:hover { background-color: #0070e0; }
        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .volume-control { display: flex; align-items: center; flex-grow: 1; margin-left: 20px; }
        .volume-control label { margin-right: 8px; font-size: 13px; color: var(--text-secondary-color); }
        .volume-control input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: #4d4d4d; outline: none; border-radius: 4px; cursor: pointer; }
        .volume-control input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: var(--text-color); border-radius: 50%; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .volume-control input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; background: var(--text-color); border-radius: 50%; cursor: pointer; border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .volume-control input[type="range"]::-moz-range-track { background: #4d4d4d; height: 8px; border-radius: 4px; border: none; }
        .status-bar { text-align: center; font-size: 13px; color: var(--text-secondary-color); margin-top: 15px; height: 20px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    </style>
</head>
<body>
    <div class="radio-container" id="mainRadioContainer"> <button class="close-btn" onclick="handleCloseMainUI()" title="Fechar Janela">X</button> <h2 id="radioTitle">XM Radio</h2>

        <div class="radio-list-section">
            <h3>Favoritas</h3>
            <ul id="radioList" class="radio-list">
                </ul>
        </div>

        <div class="custom-url-section">
            <label for="customUrl">Adicionar URL de Stream</label>
            <div class="input-group">
                <input type="text" id="customUrlInput" placeholder="https://exemplo.com/stream.mp3"> <button onclick="handlePlayCustomUrl()" title="Tocar URL customizada">Tocar</button> </div>
        </div>

        <div class="controls">
            <button id="playPauseBtn" onclick="handleTogglePlayPause()" title="Tocar/Pausar">Selecionar Rádio</button>
            <div class="volume-control">
                <label for="volumeSlider">Volume:</label>
                <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5" oninput="handleVolumeChange(this.value)" title="Ajustar Volume"> </div>
        </div>
        <div id="statusBar" class="status-bar">Nenhuma rádio tocando</div>
        </div>

    <script>
        // Referências aos elementos da UI
        const radioListElement = document.getElementById('radioList');
        const customUrlInputElement = document.getElementById('customUrlInput');
        const radioTitleElement = document.getElementById('radioTitle');
        const statusBarElement = document.getElementById('statusBar');
        const playPauseBtnElement = document.getElementById('playPauseBtn');
        const volumeSliderElement = document.getElementById('volumeSlider');
        const mainContainerElement = document.getElementById('mainRadioContainer');

        // Variáveis locais para guardar o estado que a UI *pensa* que está (para referência)
        let uiCurrentUrl = null;
        let uiCurrentName = null;
        let uiIsPlaying = false;

        // --- Funções chamadas pelo client/index.ts ---
        window.loadRadioList = function(radios) {
            radioListElement.innerHTML = '';
            radios.forEach(radio => {
                const listItem = document.createElement('li');
                listItem.textContent = radio.name;
                listItem.title = `Tocar ${radio.name}`;
                // Ao clicar, pede para o client/index.ts tocar esta rádio
                listItem.onclick = () => {
                    if (typeof mp !== 'undefined') {
                        mp.trigger('client:xmradio:playStationRequested', radio.url, radio.name);
                    } else {
                        console.log(`DEV: Pedido para tocar ${radio.name} - ${radio.url}`);
                        window.setPlaybackState(true, radio.name, radio.url); // Simula no dev
                    }
                };
                radioListElement.appendChild(listItem);
            });
        };

        window.setPlaybackState = function(isPlaying, radioName, radioUrl) {
            uiIsPlaying = isPlaying;
            uiCurrentUrl = radioUrl;
            uiCurrentName = radioName;

            if (isPlaying && radioName) {
                playPauseBtnElement.textContent = 'Tocando'; // Ou um ícone de "tocando"
                playPauseBtnElement.title = `Parar ${radioName}`; // O botão agora poderia ser um "parar tudo"
                radioTitleElement.textContent = `${radioName}`;
                updateStatusBar(`Tocando: ${radioName}`);
                // Poderia destacar o item 'radioUrl' na lista se desejado
            } else {
                playPauseBtnElement.textContent = 'Selecionar'; // Ou "Ligar Rádio"
                playPauseBtnElement.title = 'Escolha uma rádio para tocar';
                radioTitleElement.textContent = 'XM Radio';
                updateStatusBar(uiCurrentName ? `Pausado: ${uiCurrentName}` : "Nenhuma rádio tocando");
            }
        };

        window.setVolumeSlider = function(volume) {
            if (volumeSliderElement) {
                volumeSliderElement.value = volume;
            }
        };

        window.hideUI = function() {
            mainContainerElement.style.display = 'none';
        };

        window.showUI = function() {
            mainContainerElement.style.display = 'flex'; // Ou 'block'
             if (typeof mp !== 'undefined') { // Re-envia ready para garantir que o cliente saiba que a UI está visível e pronta
                mp.trigger('client:xmradio:mainUiReady');
            }
        };

        // --- Funções de manipulação de eventos da UI ---
        function handlePlayCustomUrl() {
            const url = customUrlInputElement.value.trim();
            if (url) {
                if (typeof mp !== 'undefined') {
                    mp.trigger('client:xmradio:playStationRequested', url, "Stream Customizada");
                } else {
                    console.log(`DEV: Pedido para tocar URL Customizada - ${url}`);
                    window.setPlaybackState(true, "Stream Customizada", url); // Simula no dev
                }
                customUrlInputElement.value = ''; // Limpa o campo
            } else {
                updateStatusBar("Por favor, insira uma URL válida.");
            }
        }

        function handleVolumeChange(value) {
            const newVolume = parseFloat(value);
            if (typeof mp !== 'undefined') {
                mp.trigger('client:xmradio:volumeChanged', newVolume);
            } else {
                console.log("DEV: Volume alterado para " + newVolume);
            }
        }

        function handleCloseMainUI() {
            if (typeof mp !== 'undefined') {
                mp.trigger('client:xmradio:mainUiClosed'); // Informa o client/index.ts
            }
            // A decisão de esconder visualmente pode ser feita aqui ou pelo client/index.ts
            // Para consistência, vamos deixar client/index.ts chamar window.hideUI() se necessário,
            // ou podemos fazer aqui diretamente:
            window.hideUI();
            console.log("Main UI Fechada/Escondida pelo X");
        }

        function handleTogglePlayPause() {
            // Este botão é um pouco ambíguo agora.
            // Opção 1: Se algo está tocando (uiIsPlaying), ele age como um "Desligar Rádio".
            // Opção 2: Se nada está tocando, ele não faz nada ou tenta tocar a última estação (complexo).
            // Opção 3: Ele sempre tenta "Ligar" ou "Selecionar" - o usuário escolhe da lista.
            // Por ora, vamos fazer ele tentar desligar se estiver tocando.
            if (uiIsPlaying) {
                if (typeof mp !== 'undefined') {
                    mp.trigger('client:xmradio:requestFullStop'); // Pede para desligar tudo
                } else {
                    console.log("DEV: Pedido para desligar rádio pelo Play/Pause button.");
                    window.setPlaybackState(false, null, null);
                }
            } else {
                // Se não está tocando, o botão poderia indicar para o usuário selecionar uma rádio.
                updateStatusBar("Escolha uma rádio da lista ou insira uma URL.");
            }
        }

        function updateStatusBar(message) {
            statusBarElement.textContent = message;
            statusBarElement.title = message;
        }
        
        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', () => {
            // Define o estado inicial do botão play/pause e volume
            playPauseBtnElement.textContent = 'Selecionar';
            volumeSliderElement.value = "0.5"; // Valor padrão

            if (typeof mp !== 'undefined') {
                mp.trigger('client:xmradio:mainUiReady');
                console.log('[XMRadio UI] Pronto e evento enviado.');
            } else {
                console.log('[XMRadio UI] Pronto (modo de desenvolvimento no navegador).');
                // Simula dados para teste de dev
                window.loadRadioList([
                    { name: "Rádio Exemplo 1 (Dev)", url: "url1" },
                    { name: "Rádio Exemplo 2 (Dev)", url: "url2" }
                ]);
                window.setPlaybackState(false, null, null);
            }
        });

        // Tentativa de lidar com ESC (pode precisar de ajustes ou não funcionar 100% no RAGE)
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' || event.keyCode === 27) {
                if (mainContainerElement.style.display !== 'none') { // Só se a UI estiver visível
                    event.preventDefault(); // Tenta previnir outros comportamentos do ESC
                    handleCloseMainUI();
                    console.log("ESC pressionado, tentando fechar/esconder Main UI.");
                }
            }
        });

    </script>
</body>
</html>